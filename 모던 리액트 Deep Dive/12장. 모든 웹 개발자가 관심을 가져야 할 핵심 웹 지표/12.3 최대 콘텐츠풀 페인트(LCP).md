# 12.3 최대 콘텐츠풀 페인트(LCP)

## 정의

- Largest Contentful Paint
- 페이지가 처음으로 로드를 시작한 시점부터 퓨초인트 내부에서 가장 큰 이미지 또는 텍스트를 렌더링하는 데 걸리는 시간
- 즉, 사용자에게 중요한 콘텐츠를 얼마나 빠르게 노출하는지를 측정한다.
- 뷰포트?
  - 사용자에게 현재 노출되는 화면
  - 기기에 의존하므로 뷰포트 크기는 기기마다 다르다.
  - 뷰포트 영역 밖으로 넘치는 요소가 있다면 해당 영역은 무시된다.
- 큰 이미지와 텍스트?
  - <img>
  - <svg> 내부의 <image>
  - poster 속성을 사용하는 <video>
  - url() 함수를 사용하는 CSS background-image
  - 인라인 텍스트 요소를 포함하고 있는 블록 요소
- 즉, LCP는 사용자의 기기가 노출하는 뷰포트 내부에서 가장 큰 영역을 차지하는 요소가 렌더링되는 데 얼마나 걸리는지를 측정하는 지표이다.
- 뷰포트 내에서 가장 큰 영역을 차지하는 요소가 바뀔수도 있음에 유의해야 한다.

## 의미

- DOMDocumentLoaded 이벤트: HTML 문서를 완전히 로드하고 파싱한 시점
- 이 이벤트가 호출되었다고 사용자 입장에서 페이지가 완전히 로드된 것은 아니다. DOMDocumentLoaded 이벤트는 스타일시트, 이미지, 하위 프레임임의 로딩까지 기다리지 않기 때문이다.
- 즉, 대부분이 이미지로 이루어진 뷰포트라면, DOMDocumentLoaded 시점과 사용자 입장에서의 로드 시점이 차이가 날 수 있다.
- 그래서 뷰포트에서 가장 큰 영역을 차지하는 요소가 렌더링되는 시점을 사용자 입장에서의 로드 시점이라고 정의한다.

## 기준 점수

- Good: 2.5초 이내
- Needs Improvement: 2.5초 ~ 4초
- Poor: 4초 이상

## 개선 방안

### 텍스트는 언제나 옳다

- 해당 영역을 텍스트로 채우는 방법이다.

### 이미지는 어떻게 불러올 것인가?

- 만약 이미지를 사용해야 한다면, 4가지 방법이 있다

```html
<img src="image.jpg" />
<svg xmlns="http://www.w3.org/2000/svg">
  <image href="image.jpg" />
</svg>
<video poster="image.jpg" />
<div style="background-image: url(image.jpg)"></div>
```

1. <img> 태그를 사용하는 방법
   - 브라우저의 프리로드 스캐너에 의해 발견되어 빠르게 요청이 일어난다.
   - 즉, HTML 파싱이 완료되지 않더라도 프리로드 스캐너가 병렬적으로 리소스를 다운로드한다.
2. <svg> 내부의 <image> 태그를 사용하는 방법
   - 다른 리소스를 다 불러온 이후에 이미지를 불러오기 시작한다.
   - 즉, 프리로드 스캐너에 의해 발견되지 않는다.
3. <video> 태그의 poster 속성을 사용하는 방법
   - 비디오가 재생되기 전에 노출되는 요소이다.
   - 프리로드 스캐너에 의해 발견되어 빠르게 요청이 일어난다.
   - 비디오가 LCP에 영향을 받을 것 같다면 poster 속성을 사용하는 것이 좋다.
4. CSS background-image 속성을 사용하는 방법
   - 브라우저가 해당 리소스를 필요로 하는 DOM을 그릴 준비가 될 때까지 리소스 요청을 뒤로 미룬다.
   - LCP가 중요한 리소스에는 사용하지 않는 것이 좋다.

- 결론적으로 1번, 3번 방법이 가장 좋다.

### 그 밖에 고려해야 할 사항

- 이미지는 가능한 무손실 형식으로 합축해 최소한의 용량으로 전송해야 한다.
- loading=lazy 속성은 리소스를 중요하지 않음으로 표시하여, 필요할 때만 로드하는 전략이다. LCP가 중요한 컨텐츠에는 사용하지 않는 것이 좋다.
- fadein과 같은 애니메이션 효과는 LCP를 악화시킨다.
- useEffect 내부에서 LCP 영역을 노출하게 되면, LCP가 영향을 받을 수 있다. 서버 사이드 렌더링을 사용한다면, 서버에서 미리 빌드된 채로 오는 것이 좋다.
- LCP 리소스는 같은 도메인에서 가져오는 것이 좋다. 다른 도메인에서 가져오는 것은 추가적인 DNS 조회와 TCP 연결이 필요하기 때문이다. 덜 중요한 리소스에 대해서만 이미지 최적화 서비스를 사용하는 것이 좋다.
