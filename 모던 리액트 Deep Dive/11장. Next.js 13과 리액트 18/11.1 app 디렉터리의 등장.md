# 11.1 app 디렉터리의 등장

### react-router-dom을 사용해 공통 헤더와 사이드 구현하기

- 모든 라우트 공통: <Routes> 컴포넌트 외부
- 특정 하위 주소: <Routes>의 element props에 전달하는 컴포넌트(이 컴포넌트는 <Outlet />을 포함해야 한다)

### Next.js 13 이전

- \_document는 페이지에서 쓰이는 <html>, <body>를 수정하는 등의 제한적인 용도로 사용된다.
- 페이지 공통 레이아웃을 유지할 수 있는 방법은 \_app이 유일했다. 제한적이기도 하고, 각 페이지별로 서로 다른 레이아웃을 유지할 수 있는 여지도 부족하다.

### Next.js 13 이후

- 이 한계를 극복하기 위해 나온 것이 app 디렉터리의 레이아웃이다.

## 라우팅

- /pages/a/b.tsx => /app/a/b/page.tsx
- 파일명으로 라우팅을 정의하지 못한다.

### layout.tsx

- 페이지의 기본적인 레이아웃을 구성하는 요소이다.
- 하위 폴더 및 주소(라우팅 영역)에 모두 영향을 미친다.
- URL의 query parameter(e.g. ?id=1)를 props로 받을 수 없다. 처리하려면 page.tsx를 사용해야 한다.
- 루트(/app)에 있다면, 모든 라우팅 영역에 영향을 미치는 것이라고 볼 수 있다.
- \_app, \_document를 하나로 대체할 수 있다: 모든 애플리케이션이 아니라 오로지 자신과 자식 라우팅에만 영향을 미치기 때문에 유연하게 구성이 가능하다.
- next가 제공하는 <Head>, <Body>등을 사용하지 않고, <head>, <body>를 직접 사용할 수 있다.
- children props를 사용해야 한다.
- API 요청과 같은 비동기 작업을 수행할 수 있다.

### page.tsx

- 페이지의 내용을 구성하는 요소이다.
- 이 파일이 존재하는 디렉터리에 따라 라우팅이 결정된다.
- props
  - params: 동적 라우트 매개변수(e.g. [id])를 사용하면, 해당 매개변수를 사용할 수 있다.
  - searchParams: URL의 query parameter(e.g. ?id=1)을 의미한다.

### error.tsx

- 해당 라우팅 영역에서 사용되는 공통 에러 컴포넌트이다. 특정 라우팅별로 서로 다른 에러 UI를 렌더링하는 것이 가능하다.
- 에러 바운더리는 클라이언트에서만 작동하므로 Error 컴포넌트도 클라이언트 컴포넌트여야 한다.
- 에러가 레이아웃 수준에서 발생하면, 해당 레이아웃의 error.tsx가 실행되지 않는다. 대신, 해당 레이아웃의 부모 레이아웃에 정의된 error.tsx로 이동하거나, 최상위 에러 핸들러가 처리한다.
- 레이아웃 자체가 무너지면 해당 레이아웃을 렌더링할 수 없기 때문에, 하위 경로의 에러 핸들링이 무의미해지기 때문이다. 따라서 레이아웃 에러는 상위 레이아웃이 처리하도록 설계되었다.

### not-found.tsx

- 특정 라우팅 하위의 주소를 찾을 수 없을 때 렌더링되는 컴포넌트이다.
- 전체 라우팅에서 사용하려면 /app/not-found.tsx를 작성한다.

### loading.tsx

- Suspense 컴포넌트를 사용할 때, 데이터를 불러오는 동안 렌더링되는 컴포넌트이다.
- "use client"를 사용헤 클라이언트에서 렌더링되게 할 수도 있다(?)

### route.ts

- Rest API의 GET과 같은 메서드명을 이용하여, HTTP 응답을 처리한다.
- 기존의 /pages/api 디렉터리와 비슷한 역할을 한다.
- 디렉터리와 메서드명으로 요청을 인지하고, 해당 메서드명에 해당하는 함수를 실행하여 응답을 반환한다.
- 디렉터리가 라우팅 주소를 담당하(반드시 app 디렉터리 내부에 없어도 된다)며, 파일명은 route.ts를 사용한다.
- page.tsx와 같은 디렉토리에는 존재하지 않아야 한다.
