# 2.3 클래스 컴포넌트와 함수 컴포넌트

- 함수 컴포넌트는 리액트 0.14 버전부터 있었던 오래된 컴포넌트 선언 방식이다.
- 무상태 함수 컴포넌트(stateless functional component) 즉, 별도의 상태 없이 정적으로 요소를 렌더링하려는 목적으로 사용되었다.
- 클래스 컴포넌트에서 별 다른 *생명주기 메서드나 상태*가 필요없이 render만 하는 경우에 제한적을 사용하였다.
- 리액트 16.8 버전에서 훅이 소개된 이후, 함수 컴포넌트에서 *생명주기 메서드나 상태*와 관련된 작업을 할 수 있게 되자 사용이 폭발적으로 늘었다.

## 클래스 컴포넌트

- 클래스 컴포넌트를 직접 작성하지는 않더라도 예전에 작성된 클래스 컴포넌트를 이해하기 위해서는 알아야 할 필요가 있다.

[](./classComponent/classComponent.tsx)

- `React.Component` 또는 `React.PureComponent`를 상속받을 수 있다.
- 메서드에서 `this`를 바인딩하기 위해 화살표 함수를 사용해야 한다.

### 생명주기 메서드

- 클래스 컴포넌트에서 컴포넌트의 상태가 변경될 때 리액트가 내부적으로 호출하는 함수들이 존재한다.
- 리액트 17로 넘어오면서 unsafe 하다고 선언된 메서드는 제외한다.
- 시점에 따른 메서드 분류

  - (1) 마운트: 컴포넌트가 생성되는 시점
  - (2) 업데이트: 컴포넌트의 내용이 변경되는 시점
  - (3) 언마운트: 컴포넌트가 소멸되는 시점

- 1. `render`: (1) 마운트, (2) 업데이트

  - 마운트와 업데이트 시점에 호출되는 함수이다.
  - 함수 컴포넌트의 return과 같은 역할을 하며, 내부적으로 `React.createElement`를 호출하여 가상 DOM을 구성한다.
  - _순수 함수이다. 즉, 부수 효과가 존재하면 안 된다._: 내부에서 `this.setState`를 호출해선 안 된다.

- 2. `componentDidMount`: (1) 마운트

  - 클래스 컴포넌트가 생성되고 마운트(`render`)된 이후에 첫 번째로 호출되는 함수이다.
  - `render`와 다르게 _순수 함수가 아니다._ 즉, 부수 효과가 존재하는 함수를 호출하여 state 값을 변경하는 것이 가능하다.
  - 내부에서 `this.setState`를 호출하면 리렌더링이 발생하기 때문에 API 호출, DOM에 의존적인 작업이 아니면 상태 값 초기화는 생성자에서 하는 것이 더 좋다.

- 3. `componentDidUpdate`: (2) 업데이트

  - 컴포넌트 업데이트가 일어난 직후에 호출되는 함수이다. 마운트된 직후에는 호출되지 않는다.
  - `this.setState` 호출 또는 props 변경에 의하여 리렌더링이 발생하는 경우 호출되는 함수이다.
  - 내부에서 `this.setState`를 호출한다면 무한 리렌더링이 발생할 수 있으므로 주의하자.

- 4. `componentWillUnmount`: (3) 언마운트

  - 컴포넌트가 소멸되기 직전에 호출되는 함수이다.
  - 메모리 누수나 로직 상 정리를 수행하는 cleanup 함수를 주로 호출한다: 이벤트리스너 제거, API 호출 취소, clearInterval 등...
  - 내부에서 `this.setState`를 호출할 수 없다.

- 5. `shouldComponentUpdate`: (2) 업데이트

  - state나 props의 변경으로 발생하는 `render` 함수의 호출을 중간에서 결정하는 함수이다.
  - state나 props의 변경 => `shouldComponentUpdate` => `render`
  - 반환 값으로 리렌더링을 결정하는 boolean으로 평가되는 조건식을 반환해야 한다.
    - e.g. `false`를 반환하는 경우, 어떠한 경우에도 화면에 바뀐 상태 값을 리렌더링하지 않는다.
  - 원칙적으로 `this.setState`가 호출되면 상태 값이 변경되고, 컴포넌트가 다시 호출된다.
  - 이 때, 상태 값 변경은 그대로 적용하면서(이것은 막을 수 없다) **화면에 상태 값 변경을 표시(`render`)할지를 결정하는 함수이다.**
  - `shallowEqual`이 내부 값이 똑같더라도 참조가 다르면 반드시 `render`를 호출하였던 경우를 처리할 수 있다.
  - `this.setState`를 호출하면 `shallowEqual === false`이기 때문에 내부의 값이 똑같더라도 `render`를 호출한다: 얕은 비교만 수행하기 때문이다.
  - 얕은 비교로 참조가 다르더라도, 내부 값이 완전히 동일하다면 `render`를 호출하지 않도록 `shouldComponentUpdate`를 제어하여 렌더링을 수행하지 않을 수 있다.
  - 함수 컴포넌트에서는 `React.memo`, `useMemo`, `useCallback` 으로 비슷하게 구현이 가능하다.

- [](./pureComponent/pureComponent.tsx)

  - `PureComponent`는 state와 props의 모든 key에 대해 값이 얕은 비교를 수행하고, 이를 바탕으로 `render` 호출 여부를 결정한다.
  - **이미 `this.setState`를 호출해서 render를 호출해야 하는 상황이지만, 또 한 번 key에 대해 얕은 비교를 수행하고 모두 이전과 같다면 `render`를 호출을 생략해 렌더링 비용을 아끼는 역할을 한다.**
  - 그럼 모든 컴포넌트를 `PureComponent`로 선언하는 것이 좋은가?
    - 이 컴포넌트 역시 얕은 비교만 수행하기 때문에, 중첩 객체 구조에 대해서는 제대로 작동하지 않는다.
    - 내부적으로 모든 key에 대해 `shallowEqual`을 다시 호출해야 하므로 성능적으로 좋지 않다.
  - 따라서 필요할 때 활용하는 것이 성능에 더 도움이 된다.

```js
// PureComponent 예상 구현
shouldComponentUpdate(nextProps, nextState) {
	return shallowCompare(this.props, nextProps) || shallowCompare(this.state, nextState);
}

function shallowCompare(prev, next) {
  if (prev === next) return false;

  if (typeof prev !== "object" || typeof next !== "object") return true;

  const keysPrev = Object.keys(prev);
  const keysNext = Object.keys(next);

  if (keysPrev.length !== keysNext.length) return true;

  for (let i = 0; i < keysPrev.length; i++) {
    if (prev[keysPrev[i]] !== next[keysPrev[i]]) {
      return true;
    }
  }

  return false;
}
```

- 6. `static getDerivedStateFromProps`: (1) 마운트, (2) 업데이트

  - `render`를 호출하기 직전에 호출되는 함수이다. 주로 props가 변경될 때 state를 업데이트해야 하는 경우에 사용한다.
    - state를 props로 동기화해야 할 때
    - props에 의존적인 값을 state로 저장해야 할 때
  - 하지만 props와 state를 동기화하는 방법보다 props를 직접 사용하는 방법을 권장한다. 그 방법이 더 간단하고 직관적이다.
  - 가장 최근에 도입된 생명주기 메서드 중 하나이다.
  - `componentWillReceiveProps` 메서드를 대체한다.
  - 다른 메서드와의 차이는 static으로 선언되어 있어서 내부에서 `this`에 접근할 수 없다.
  - 반환하는 객체는 상태 값으로 적용된다.

- 7. `getSnapShotBeforeUpdate`: (1) 마운트, (2) 업데이트

  - 렌더링 이후 DOM에 접근하기 위한 메커니즘의 함수이다.
  - DOM이 업데이트되기 직전에 호출된다. (`render` => `getSnapShotBeforeUpdate` => `componentDidUpdate`)
  - 컴포넌트가 DOM에 업데이트되기 전 상태를 캡처해야할 때 사용되며, 반환한 값은 `componentDidUpdate` 메서드의 인자로 전달된다.
  - DOM에 렌더링되기 전에 윈도우 크기, 스크롤 위치 등을 기록할 수 있고 기록한 값을 `componentDidUpdate` 메서드에서 사용할 수 있다.
  - `componentWillUpdate` 메서드를 대체한다.
  - _아직 리액트 훅으로 구현되어 있지 않기 때문에 이 기능이 필요하다면 클래스 컴포넌트를 사용해야 한다._
  - 어떻게 이 메서드를 호출할 수 있는가?

- 8. `getDerivedStateFromError`
