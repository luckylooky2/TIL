# 13.2 구글 라이트하우스

- 기존 방식의 단점: 기존 애플리케이션 코드의 수정이 필요하다.
- 구글 라이트하우스를 통해 별도의 코드 수정 없이 지표를 수집할 수 있다.
- 핵심 웹 지표, 접근성, PWA, SEO 등 다양한 요소를 측정하고 점검할 수 있다.
- 설치 방법
  1. 브라우저 확장 프로그램으로 설치
  2. 크롬 개발자 도구
  3. CLI: npm lighthouse => 깃허브 액션 등 터미널만 사용할 수 있는 CI/CD 환경에서 사용하기 적합하다.
- [개발자 도구] - [Lighthouse 탭]
- 모드: 탐색, 기간, 스냅샷
- 기기(페이지 접근 환경, 뷰포트): 모바일, 데스크탑
- 카테고리: 성능, 접근성, 권장사항, 검색엔진 최적화, 프로그레이시브 웹 앱 등

## 탐색 모드

- 페이지를 _처음부터 다시 불러와서_ 페이지 로딩이 끝날 때까지 지표를 수집한다.

### 성능

- [ ] FCP, LCP, CLS
- [ ] Time to Interactive
  - 사용자가 페이지와 상호작용할 수 있는 시간이다.
  - FCP로 측정되는 페이지 내 콘텐츠가 표시되는 시점 / 보여지는 페이지 요소의 대부분에 이벤트 핸들러가 부착되는 시점 / 페이지가 유저의 상호작용에 50ms 이내로 반응하는 시점
  - Good(0-3.8s), Needs improvement(3.8-7.3s), Poor(7.3s 이상)
- [ ] Speed Index
  - 페이지가 로드되는 동안, 페이지가 얼마나 빨리 표시되는지를 나타낸다.
  - 실시간으로 이미지를 캡쳐하고, Speedline를 사용해 캡쳐된 이미지를 분석해 계산한다.
  - Good(0-3.4s), Needs improvement(3.4-5.8s), Poor(5.8s 이상)
- [ ] Total Blocking Time
  - 메인 스레드에서 50ms 이상 실행되는 모든 작업의 합이다. 즉, 긴 작업이 수행될 때마다 메인 스레드가 차단된 것으로 간주한다.
  - 대상: FCP 부터 TTI 사이의 모든 작업. 즉, 사용자가 작업이 늦어지는 것을 눈치챌 수 있는 시간만 대상으로 한다.
  - Good(0-150ms), Needs improvement(150-250ms), Poor(250ms 이상)

### 접근성

- [ ] 신체적으로 불편한 사람들이 일반적인 사용자와 동등하게 웹 페이지를 이용할 수 있도록 보장하는 것을 뜻한다.
- [ ] 그림이나 사진의 경우, 적절한 대체 텍스트를 제공해야 한다.
- [ ] 오디오나 비디오의 경우, 자막을 제공해야 한다.
- [ ] 마우스를 활용할 수 없는 경우, 키보드만으로 모든 컨텐츠에 접근할 수 있도록 해야 한다.

### 권장사항

- [ ] CSP가 XSS 공격에 효과적인지 확인
  - XSS: 제3자가 삽입한 스크립트를 실행시키는 공격
  - CSP: 웹 사이트에서 실행되는 스크립트의 출처를 제한하는 보안 정책. 정적 컨텐츠(이미지, 스타일, 스크립트) + 주소, 도메인 정보도 포함.
- [ ] 감지된 Javascript 라이브러리: e.g. jQuery, React, Next.js, Lodash, create-react-app 등
- [ ] HTTPS 사용
- [ ] 페이지 로드 시 위치 정보 / 알림 권한 요청 방지하기: 페이지 접근 시 바로 권한을 요청하는 것을 막아야 한다.
- [ ] 알려진 보안 취약점이 있는 프런트엔드 자바스크립트 라이브러리를 사용하지 않음
- [ ] 사용자가 비밀번호 입력란에 붙여넣을 수 있도록 허용
- [ ] 이미지를 올바른 가로세로 비율로 표시
- [ ] 이미지가 적절한 해상도로 제공됨: 이미지 실제 크기보다 더 크게 이미지를 표현하는 것을 막아야 한다.
- [ ] 페이지에 HTML Doctype이 있음
- [ ] 문자 집합을 제대로 정의함: 대부분 `<meta charset="utf-8">`로 지정한다.
- [ ] 지원 중단 API 사용하지 않기
- [ ] 콘솔에 로그된 브라우저 오류 없음: 콘솔에 에러가 기록되지 않도록 해야 한다.
- [ ] Chrome Devtools의 Issue 패널에 문제없음
- [ ] 페이지에 유효한 소스 맵이 있음: 프로덕션에서는 소스 맵을 제거해도 된다.
- [ ] font-display: optional을 사용하는 폰트가 미리 로드됨

### 검색 엔진 최적화

- [ ] 문서를 크롤링하기 쉽게 만들었는지
- [ ] robots.txt가 유효한지
- [ ] 이미지와 링크에 설명 문자가 존재하는지
- [ ] <meta>나 <title> 등으로 페이지의 정보를 빠르게 확인할 수 있는지

## 기간 모드

- 탐색 모드가 페이지가 로딩되면서 지표를 측정한 것이라면, 기간 모드는 실제 웹 페이지를 탐색하는 동안 지표를 측정한다.
- 모드 시작을 누르고 작업을 수행한 다음 종료하면, 그 사이의 모든 작업에 대한 지표를 확인할 수 있다.
- 사용자가 빈번하게 수행할 것으로 예상되는 작업을 기간 모드로 측정하면, 성능 최적화에 도움이 된다.
- 성능, 권장사항 결과는 탐색 모드와 동일하다.

### 흔적

- View Trace
- 웹 성능을 추적한 기간을 성능 탭에서 보여준다.

### 트리맵

- Tree Map
- 페이지를 불러올 때 함께 로딩한 모든 리소스를 모아서 볼 수 있다.
- 전체 자바스크립트 리소스 중 각 파일이 차지하는 비율 및 데이터의 크기를 그림으로 보여준다.
- 로딩한 리소스 중 사용되지 않은 바이트의 크기를 확인할 수 있다.
- 이 파일들은 소스 탭에서 어떻게 제공되는지 확인할 수 있다.

## 스냅샷 모드

- 탐색 모드와 매우 유사하지만, 현재 페이지를 기준으로 분석한다는 점이 다르다.
- 현재 상태(페이지)에서 지표를 분석할 수 있다.
- 기간 분석을 수행하지 않기 때문에 분석할 수 있는 내용이 제한적이다.
